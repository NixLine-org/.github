#
# Nix flake.lock updater (reusable)
#
# Updates Nix flake.lock files and creates pull requests with the changes.
# Provides customizable PR titles, labels, and assignee options for
# automated dependency management in Nix-based projects.
#
# Triggered by: workflow_call from consumer repositories
# Purpose: Automated Nix dependency updates via flake.lock
# Features: Custom PR titles/labels, assignee support, automated updates
#

name: Nix flake.lock updater (reusable)
on:
  workflow_call:
    inputs:
      pr-title:
        {
          required: false,
          default: "chore(nix): update flake.lock",
          type: string,
        }
      pr-labels:
        {
          required: false,
          default: "dependencies, nix, automated",
          type: string,
        }
# Note: This workflow requires the following permissions:
# permissions:
#   contents: write         # To commit flake.lock updates
#   pull-requests: write    # To create PRs for updates

permissions:
  contents: write
  pull-requests: write
jobs:
  update-flake-lock:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - uses: DeterminateSystems/determinate-nix-action@v3.12.0
      - uses: DeterminateSystems/update-flake-lock@v24
        with:
          pr-title: "${{ inputs.pr-title }}"
          pr-labels: "${{ inputs.pr-labels }}"
          token: "${{ secrets.GITHUB_TOKEN }}"
